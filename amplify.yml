version: 1
frontend:
  phases:
    preBuild:
      commands:
        - ZOLA_VERSION=$(python -c "import json, urllib.request; data=json.load(urllib.request.urlopen('https://api.github.com/repos/getzola/zola/releases/latest')); print(data['tag_name'])")
        - curl -sL "https://github.com/getzola/zola/releases/download/${ZOLA_VERSION}/zola-${ZOLA_VERSION}-x86_64-unknown-linux-musl.tar.gz" -o zola.tar.gz
        - tar -xzf zola.tar.gz
        - chmod +x zola
        - sudo mv zola /usr/local/bin/zola
        - zola --version
    build:
      commands:
        - zola build
  artifacts:
    baseDirectory: public
    files:
      - "**/*"
customHeaders:
  - pattern: "**/*"
    headers:
      - key: "Strict-Transport-Security"
        value: "max-age=31536000; includeSubDomains"
      - key: "Content-Security-Policy"
        value: "default-src 'self'; base-uri 'self'; object-src 'none'; frame-ancestors 'self'; img-src 'self' data:; font-src 'self' data:; script-src 'self'; style-src 'self' 'unsafe-inline'"
      - key: "X-Frame-Options"
        value: "SAMEORIGIN"
      - key: "X-Content-Type-Options"
        value: "nosniff"
      - key: "Referrer-Policy"
        value: "strict-origin-when-cross-origin"
      - key: "Permissions-Policy"
        value: "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()"
