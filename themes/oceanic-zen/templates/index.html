<!DOCTYPE html>
<html lang="en">
    <head>
        {% block head %}
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        {% set is_page = page is defined %}
        {% set is_section = section is defined %}
        {% set site_title = config.title | default(value="") %}
        {% set meta_description = config.description %}
        {% if is_page %}
            {% if page.summary %}
                {% set meta_description = page.summary | striptags | trim %}
            {% elif page.description %}
                {% set meta_description = page.description | striptags | trim %}
            {% endif %}
        {% elif is_section %}
            {% if section.description %}
                {% set meta_description = section.description | striptags | trim %}
            {% elif section.summary %}
                {% set meta_description = section.summary | striptags | trim %}
            {% endif %}
        {% endif %}
        {% if meta_description -%}
        <meta name="description" content="{{ meta_description }}">
        {% endif %}

        <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
        <script data-goatcounter="https://yelladev.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

        {% set canonical_url = config.base_url %}
        {% if is_page %}
            {% set canonical_url = page.permalink %}
        {% elif is_section %}
            {% set canonical_url = section.permalink %}
        {% endif %}
        <link rel="canonical" href="{{ canonical_url }}">

        {% set og_title = site_title %}
        {% if is_page %}
            {% set og_title = page.title ~ " | " ~ site_title %}
        {% elif is_section %}
            {% set og_title = section.title ~ " | " ~ site_title %}
        {% endif %}

        {% set og_image = config.extra.social_image %}
        {% if is_page %}
            {% if page.extra.preview_image %}
                {% set og_image = page.extra.preview_image %}
            {% else %}
                {% set parts = page.content | split(pat='src="') %}
                {% if parts | length > 1 %}
                    {% set og_image = (parts[1] | split(pat='"') | first) %}
                {% else %}
                    {% set parts = page.content | split(pat="src='") %}
                    {% if parts | length > 1 %}
                        {% set og_image = (parts[1] | split(pat="'") | first) %}
                    {% endif %}
                {% endif %}
            {% endif %}
        {% endif %}

        <meta property="og:type" content="{% if is_page %}article{% else %}website{% endif %}">
        <meta property="og:url" content="{{ canonical_url }}">
        <meta property="og:title" content="{{ og_title }}">
        {% if meta_description -%}
        <meta property="og:description" content="{{ meta_description }}">
        {% endif %}
        {% if og_image -%}
        <meta property="og:image" content="{{ og_image }}">
        {% endif %}

        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="{{ og_title }}">
        {% if meta_description -%}
        <meta name="twitter:description" content="{{ meta_description }}">
        {% endif %}
        {% if og_image -%}
        <meta name="twitter:image" content="{{ og_image }}">
        {% endif %}

        {% if is_page and page.date %}
        {% set author_name = page.author | default(value=config.extra.author) %}
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "BlogPosting",
            "headline": {{ page.title | json_encode }},
            "description": {{ meta_description | json_encode }},
            "datePublished": {{ page.date | date(format="%Y-%m-%d") | json_encode }},
            "author": {
                "@type": "Person",
                "name": {{ author_name | json_encode }}
            },
            "publisher": {
                "@type": "Organization",
                "name": {{ site_title | json_encode }}
            },
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": {{ canonical_url | json_encode }}
            }{% if og_image %},
            "image": {{ og_image | json_encode }}{% endif %}
        }
        </script>
        {% endif %}

        <title>
            {% block title %}
                {% if is_page %}
                    {{ page.title }} | {{ site_title }}
                {% elif is_section %}
                    {{ section.title }} | {{ site_title }}
                {% else %}
                    {{ site_title }}
                {% endif %}
            {% endblock title %}
        </title>

        <script>
            (function() {
                try {
                    var stored = localStorage.getItem("theme");
                    var prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
                    if (stored === "dark" || (!stored && prefersDark)) {
                        document.documentElement.setAttribute("data-theme", "dark");
                    }
                } catch (e) {}
            })();
        </script>

        {% block css %}
            <link rel="stylesheet" href="{{ get_url(path="theme.css", trailing_slash=false) | safe }}">
        {% endblock css %}
        {% endblock head %}
    </head>
    <body>
        <div class="content">
        {% block body%}
        {% block header %}
            <header>
                <div class="header-left">
                    <a href="{{ config.base_url }}" class="logo">{{ config.title }}</a>
                </div>
                <div class="header-right">
                    {% set current_path_val = current_path | default(value="/") %}
                    {% set current_parts = current_path_val | split(pat="/") %}
                    {% set current_root = "" %}
                    {% if current_parts | length > 1 %}
                        {% set current_root = current_parts[1] %}
                    {% endif %}
                    {% set current_sub = "" %}
                    {% if current_parts | length > 2 %}
                        {% set current_sub = current_parts[2] %}
                    {% endif %}
                    {% set is_home = current_path_val == "/" %}
                    {% set is_blog = current_root == "blog" %}
                    {% set is_about = current_root == "about" and current_sub == "" %}
                    {% set is_books = current_root == "about" and current_sub == "books" %}
                    {% set is_projects = current_root == "about" and current_sub == "projects" %}
                    {% set is_photography = current_root == "photography" %}
                    <nav itemscope itemtype="http://schema.org/SiteNavigationElement">
                      <ul>
                        <li class="nav">
                            <a itemprop="url" class="nav-link{% if is_home %} is-active{% endif %}" href="{{ config.base_url }}">
                                <span itemprop="name">Home</span>
                            </a>
                        </li>
                        {% set blog = get_section(path="blog/_index.md") %}
                        {% set about = get_section(path="about/_index.md") %}
                        {% set photography = get_section(path="photography/_index.md") %}
                        {% set books = get_page(path="about/books.md") %}
                        {% set projects = get_page(path="about/projects.md") %}
                        {% if blog %}
                        <li class="nav">
                            <a itemprop="url" class="nav-link{% if is_blog %} is-active{% endif %}" href="{{ blog.permalink | safe}}">
                                <span itemprop="name">Blog</span>
                            </a>
                        </li>
                        {% endif %}
                        {% if about %}
                        <li class="nav">
                            <a itemprop="url" class="nav-link{% if is_about %} is-active{% endif %}" href="{{ about.permalink | safe}}">
                                <span itemprop="name">About</span>
                            </a>
                        </li>
                        {% endif %}
                        <li class="nav">
                            <a itemprop="url" class="nav-link{% if is_books %} is-active{% endif %}" href="{{ books.permalink | safe }}">
                                <span itemprop="name">Books</span>
                            </a>
                        </li>
                        <li class="nav">
                            <a itemprop="url" class="nav-link{% if is_projects %} is-active{% endif %}" href="{{ projects.permalink | safe }}">
                                <span itemprop="name">Projects</span>
                            </a>
                        </li>
                        {% if photography %}
                        <li class="nav">
                            <a itemprop="url" class="nav-link{% if is_photography %} is-active{% endif %}" href="{{ photography.permalink | safe}}">
                                <span itemprop="name">Photography</span>
                            </a>
                        </li>
                        {% endif %}
                        {% if config.extra.github %}
                        <li class="nav">
                            <a itemprop="url" href="https://github.com/{{ config.extra.github }}">
                                <img class="icon" src="{{ config.base_url }}/icons/github.svg" alt="Github">
                            </a>
                        </li>
                        {% endif %}
                        {% if config.extra.twitter %}
                        <li class="nav">
                            <a itemprop="url" href="https://twitter.com/{{ config.extra.twitter }}">
                                <img class="icon" src="{{ config.base_url }}/icons/twitter.svg" alt="Twitter">
                            </a>
                        </li>
                        {% endif %}
                        <li class="nav">
                            <button class="theme-toggle" type="button" aria-label="Toggle dark mode" title="Toggle dark mode">
                                <i class="bx bx-moon icon-moon" aria-hidden="true"></i>
                                <i class="bx bx-sun icon-sun" aria-hidden="true"></i>
                            </button>
                        </li>
                      </ul>
                    </nav>
                </div>
            </header>
        {% endblock header %}
        {% block content %}
        <main>
            {% block main %}
            {% if section %}
                <article itemscope itemtype="http://schema.org/BlogPosting">
                    <div itemprop="headline">
                        <h1>{{ section.title }}</h1>
                        <div class="border"></div>
                    </div>
                    {% if section.content %}
                    <div itemprop="articleBody">
                        {{ section.content | safe }}
                    </div>
                    {% endif %}
                </article>
            {% else %}
                <h1>{{ config.title }}</h1>
                <div class="border"></div>
            {% endif %}
            {% endblock main %}
        </main>
        {% endblock content %}
        <footer>
            {% block footer %}
            <div class="border"></div>
            <div class="footer">
                <small class="footer-left">
                    Copyright &copy; {{ config.extra.author }}
                </small>
                <small class="footer-right">
                    Powered by <a href="https://www.getzola.org">Zola</a> | Theme <a href="https://github.com/barlog-m/oceanic-zen">Oceanic Zen</a>
                </small>
            </div>
        {% endblock footer %}
        </footer>
    {% endblock body%}
        </div>
        <script>
            (function() {
                var button = document.querySelector(".post-tts");
                if (!button || !("speechSynthesis" in window)) {
                    if (button) {
                        button.style.display = "none";
                    }
                    return;
                }

                var state = "idle";
                var utterance = null;

                function setState(next) {
                    state = next;
                    button.setAttribute("data-tts-state", state);
                    if (state === "playing") {
                        button.querySelector("span").textContent = "Stop";
                        button.setAttribute("aria-label", "Stop narration");
                    } else {
                        button.querySelector("span").textContent = "Listen";
                        button.setAttribute("aria-label", "Listen to article");
                    }
                }

                function buildText() {
                    var article = document.querySelector('article.post [itemprop="articleBody"]');
                    if (!article) {
                        return "";
                    }
                    var text = article.innerText || "";
                    return text.replace(/\\s+/g, " ").trim();
                }

                function cancel() {
                    if ("speechSynthesis" in window) {
                        window.speechSynthesis.cancel();
                    }
                    utterance = null;
                }

                button.addEventListener("click", function() {
                    if (state === "idle") {
                        var text = buildText();
                        if (!text) {
                            return;
                        }
                        utterance = new SpeechSynthesisUtterance(text);
                        utterance.onend = function() {
                            setState("idle");
                            utterance = null;
                        };
                        utterance.onerror = function() {
                            setState("idle");
                            utterance = null;
                        };
                        window.speechSynthesis.speak(utterance);
                        setState("playing");
                        return;
                    }

                    if (state === "playing") {
                        cancel();
                        setState("idle");
                    }
                });

                window.addEventListener("beforeunload", cancel);
            })();
        </script>
        <script src="{{ get_url(path="js/theme-toggle.js", trailing_slash=false) | safe }}"></script>
    </body>
</html>
